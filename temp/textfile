steps:
- task: KubernetesManifest@0
  displayName: deploy
  inputs:
    kubernetesServiceConnection: k8s
    namespace: default
    manifests: '$(System.DefaultWorkingDirectory)/_Qutianer_dev-nhl/infrastructure/main.yaml'



steps:
- task: Kubernetes@1
  displayName: 'kubectl '
  inputs:
    connectionType: 'Azure Resource Manager'
    azureSubscriptionEndpoint: 'main_rg'
    azureResourceGroup: main
    kubernetesCluster: kkkk
    useClusterAdmin: true

resource "azuredevops_serviceendpoint_kubernetes" "dev" {
  project_id            = azuredevops_project.project.id
  service_endpoint_name = "Sample Kubernetes"
  apiserver_url         = "https://sample-kubernetes-cluster.hcp.westeurope.azmk8s.io"
  authorization_type    = "AzureSubscription"

  azure_subscription {
    subscription_id   = var.subscription_id
    subscription_name = "MySubscription"
    tenant_id         = var.tenant_id
    resourcegroup_id  = "main"
    namespace         = "default"
    cluster_name      = "ddd"
  }
}

resource "azuredevops_resource_authorization" "k8s" {
  project_id  = azuredevops_project.project.id
  resource_id = azuredevops_serviceendpoint_azurerm.dev.id
  authorized  = true
}
